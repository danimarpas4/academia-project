{% extends 'simulador/base.html' %}

{% block content %}
<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            
            {% if tiempo_limite > 0 %}
            <div class="sticky-top mb-3 text-center" style="top: 20px; z-index: 1000;">
                <span class="badge bg-danger fs-5 shadow-lg border border-warning" id="cronometro">
                    ‚è±Ô∏è {{ tiempo_limite }}:00
                </span>
            </div>
            {% endif %}

            <form method="POST" id="examenForm">
                {% csrf_token %}
                
                <div class="card bg-dark text-white border-secondary shadow-lg">
                    <div class="card-header bg-gradient bg-primary text-white p-4">
                        <h2 class="h4 mb-0 fw-bold">üìù EJECUCI√ìN DEL SIMULACRO</h2>
                        <small class="text-light opacity-75">Responde con decisi√≥n. La duda mata.</small>
                    </div>

                    <div class="card-body p-4 bg-black">
                        
                        {% if not preguntas %}
                            <div class="alert alert-warning text-center">
                                ‚ö†Ô∏è No se han cargado preguntas. 
                                <br>Vuelve a configuraci√≥n y aseg√∫rate de elegir temas que tengan contenido.
                            </div>
                        {% endif %}

                        {% for p in preguntas %}
                        <div class="mb-5 p-3 rounded border border-secondary" style="background-color: #1a1a1a;">
                            <h5 class="mb-3 text-warning">
                                <span class="badge bg-secondary me-2">{{ forloop.counter }}</span>
                                {{ p.enunciado }}
                            </h5>

                            <div class="d-grid gap-2">
                                {% for opcion in p.opciones.all %}
                                <div class="form-check custom-radio-box p-0">
                                    <input class="btn-check" type="radio" 
                                           name="pregunta_{{ p.id }}" 
                                           id="opt_{{ opcion.id }}" 
                                           value="{{ opcion.id }}">
                                    
                                    <label class="btn btn-outline-light w-100 text-start p-3 border-secondary" 
                                           for="opt_{{ opcion.id }}">
                                        {{ opcion.texto }}
                                    </label>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        {% endfor %}

                        <div class="d-grid gap-2 mt-5">
                            <button type="submit" class="btn btn-success btn-lg py-3 fw-bold text-uppercase shadow hover-scale">
                                ‚úÖ FINALIZAR Y ENTREGAR
                            </button>
                        </div>

                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    let tiempoRestante = {{ tiempo_limite }} * 60; // Convertir minutos a segundos
    
    if (tiempoRestante > 0) {
        const display = document.getElementById('cronometro');
        
        const intervalo = setInterval(() => {
            let minutos = Math.floor(tiempoRestante / 60);
            let segundos = tiempoRestante % 60;
            
            segundos = segundos < 10 ? '0' + segundos : segundos;
            display.textContent = `‚è±Ô∏è ${minutos}:${segundos}`;
            
            if (tiempoRestante <= 0) {
                clearInterval(intervalo);
                alert("¬°TIEMPO AGOTADO! Se entregar√° el examen autom√°ticamente.");
                document.getElementById('examenForm').submit();
            }
            tiempoRestante--;
        }, 1000);
    }
</script>

<style>
    /* Estilo para que las opciones parezcan botones modernos */
    .btn-check:checked + .btn-outline-light {
        background-color: #ffc107; /* Amarillo militar */
        color: #000;
        border-color: #ffc107;
        font-weight: bold;
    }
    .btn-outline-light:hover {
        background-color: #333;
    }
</style>
{% endblock %}